<UserControl xmlns="https://github.com/avaloniaui"
             xmlns:x="http://schemas.microsoft.com/winfx/2006/xaml"
             xmlns:vm="using:Miscord.Client.ViewModels"
             x:Class="Miscord.Client.Views.AdminPanelView"
             x:DataType="vm:AdminPanelViewModel">

    <ScrollViewer VerticalScrollBarVisibility="Auto">
        <StackPanel Spacing="24" MaxWidth="800">
            <!-- Header -->
            <TextBlock Text="Server Administration"
                       FontSize="20"
                       FontWeight="Bold"
                       Foreground="White"/>

            <!-- Tab Buttons -->
            <StackPanel Orientation="Horizontal" Spacing="8">
                <Button Command="{Binding SelectTabCommand}"
                        CommandParameter="Invites"
                        Content="Invites"
                        Padding="16,8"
                        CornerRadius="4"
                        FontWeight="SemiBold"
                        Classes.selected="{Binding IsInvitesTabSelected}">
                    <Button.Styles>
                        <Style Selector="Button">
                            <Setter Property="Background" Value="#4f545c"/>
                            <Setter Property="Foreground" Value="#dcddde"/>
                        </Style>
                        <Style Selector="Button.selected">
                            <Setter Property="Background" Value="#5865f2"/>
                            <Setter Property="Foreground" Value="White"/>
                        </Style>
                    </Button.Styles>
                </Button>
                <Button Command="{Binding SelectTabCommand}"
                        CommandParameter="Users"
                        Content="Users"
                        Padding="16,8"
                        CornerRadius="4"
                        FontWeight="SemiBold"
                        Classes.selected="{Binding IsUsersTabSelected}">
                    <Button.Styles>
                        <Style Selector="Button">
                            <Setter Property="Background" Value="#4f545c"/>
                            <Setter Property="Foreground" Value="#dcddde"/>
                        </Style>
                        <Style Selector="Button.selected">
                            <Setter Property="Background" Value="#5865f2"/>
                            <Setter Property="Foreground" Value="White"/>
                        </Style>
                    </Button.Styles>
                </Button>
                <Button Command="{Binding SelectTabCommand}"
                        CommandParameter="Config"
                        Padding="16,8"
                        CornerRadius="4"
                        FontWeight="SemiBold"
                        Classes.selected="{Binding IsConfigTabSelected}"
                        Classes.warning="{Binding HasMissingConfiguration}">
                    <StackPanel Orientation="Horizontal" Spacing="6">
                        <TextBlock Text="Config"/>
                        <TextBlock Text="!"
                                   FontWeight="Bold"
                                   IsVisible="{Binding HasMissingConfiguration}"/>
                    </StackPanel>
                    <Button.Styles>
                        <Style Selector="Button">
                            <Setter Property="Background" Value="#4f545c"/>
                            <Setter Property="Foreground" Value="#dcddde"/>
                        </Style>
                        <Style Selector="Button.selected">
                            <Setter Property="Background" Value="#5865f2"/>
                            <Setter Property="Foreground" Value="White"/>
                        </Style>
                        <Style Selector="Button.warning:not(.selected)">
                            <Setter Property="Foreground" Value="#faa61a"/>
                        </Style>
                    </Button.Styles>
                </Button>
            </StackPanel>

            <!-- Invites Tab -->
            <StackPanel IsVisible="{Binding IsInvitesTabSelected}"
                        Spacing="16">
                <!-- Create Invite Section -->
                <Border Background="#2f3136" CornerRadius="8" Padding="16">
                    <StackPanel Spacing="12">
                        <TextBlock Text="CREATE NEW INVITE"
                                   FontSize="12"
                                   FontWeight="SemiBold"
                                   Foreground="#72767d"/>

                        <StackPanel Orientation="Horizontal" Spacing="12">
                            <StackPanel Spacing="4">
                                <TextBlock Text="Max Uses (0 = unlimited)"
                                           FontSize="11"
                                           Foreground="#b9bbbe"/>
                                <NumericUpDown Value="{Binding NewInviteMaxUses}"
                                               Minimum="0"
                                               Maximum="1000"
                                               Width="150"
                                               Background="#202225"
                                               Foreground="White"
                                               BorderThickness="0"/>
                            </StackPanel>

                            <Button Command="{Binding CreateInviteCommand}"
                                    Content="Create Invite"
                                    Background="#43b581"
                                    Foreground="White"
                                    Padding="16,8"
                                    CornerRadius="4"
                                    FontWeight="SemiBold"
                                    VerticalAlignment="Bottom"
                                    IsEnabled="{Binding !IsCreatingInvite}"/>
                        </StackPanel>

                        <TextBlock Text="{Binding CreateInviteError}"
                                   Foreground="#f04747"
                                   FontSize="13"
                                   IsVisible="{Binding CreateInviteError, Converter={x:Static StringConverters.IsNotNullOrEmpty}}"/>
                    </StackPanel>
                </Border>

                <!-- Invites List -->
                <StackPanel Spacing="8">
                    <StackPanel Orientation="Horizontal" Spacing="8">
                        <TextBlock Text="INVITES"
                                   FontSize="12"
                                   FontWeight="SemiBold"
                                   Foreground="#72767d"
                                   VerticalAlignment="Center"/>
                        <Button Command="{Binding RefreshInvitesCommand}"
                                Content="Refresh"
                                Background="Transparent"
                                Foreground="#72767d"
                                Padding="8,4"
                                FontSize="11"
                                BorderThickness="0"/>
                    </StackPanel>

                    <TextBlock Text="{Binding InvitesError}"
                               Foreground="#f04747"
                               FontSize="13"
                               IsVisible="{Binding InvitesError, Converter={x:Static StringConverters.IsNotNullOrEmpty}}"/>

                    <TextBlock Text="Loading..."
                               Foreground="#72767d"
                               IsVisible="{Binding IsLoadingInvites}"/>

                    <ItemsControl ItemsSource="{Binding Invites}">
                        <ItemsControl.ItemTemplate>
                            <DataTemplate DataType="{x:Type vm:InviteViewModel}">
                                <Border Background="#2f3136" CornerRadius="8" Padding="16" Margin="0,0,0,8">
                                    <Grid ColumnDefinitions="*,Auto">
                                        <StackPanel Spacing="8">
                                            <StackPanel Orientation="Horizontal" Spacing="12">
                                                <TextBlock Text="{Binding Code}"
                                                           FontSize="16"
                                                           FontWeight="SemiBold"
                                                           Foreground="White"
                                                           FontFamily="Consolas, Monaco, monospace"/>
                                                <TextBlock Text="{Binding StatusDisplay}"
                                                           FontSize="12"
                                                           Foreground="#43b581"
                                                           VerticalAlignment="Center"
                                                           Classes.revoked="{Binding IsRevoked}">
                                                    <TextBlock.Styles>
                                                        <Style Selector="TextBlock.revoked">
                                                            <Setter Property="Foreground" Value="#f04747"/>
                                                        </Style>
                                                    </TextBlock.Styles>
                                                </TextBlock>
                                            </StackPanel>

                                            <StackPanel Orientation="Horizontal" Spacing="16">
                                                <TextBlock FontSize="12" Foreground="#72767d">
                                                    <Run Text="Uses: "/>
                                                    <Run Text="{Binding UsesDisplay}" Foreground="#b9bbbe"/>
                                                </TextBlock>
                                                <TextBlock FontSize="12" Foreground="#72767d">
                                                    <Run Text="Expires: "/>
                                                    <Run Text="{Binding ExpiresDisplay}" Foreground="#b9bbbe"/>
                                                </TextBlock>
                                                <TextBlock FontSize="12" Foreground="#72767d">
                                                    <Run Text="Created by: "/>
                                                    <Run Text="{Binding CreatedByUsername, FallbackValue='System'}" Foreground="#b9bbbe"/>
                                                </TextBlock>
                                            </StackPanel>

                                            <TextBlock Text="{Binding Error}"
                                                       Foreground="#f04747"
                                                       FontSize="12"
                                                       IsVisible="{Binding Error, Converter={x:Static StringConverters.IsNotNullOrEmpty}}"/>
                                        </StackPanel>

                                        <StackPanel Grid.Column="1" Orientation="Horizontal" Spacing="8">
                                            <Button Command="{Binding CopyCodeCommand}"
                                                    Content="Copy"
                                                    Background="#4f545c"
                                                    Foreground="White"
                                                    Padding="12,6"
                                                    CornerRadius="4"
                                                    FontSize="12"/>
                                            <Button Command="{Binding RevokeCommand}"
                                                    Content="Revoke"
                                                    Background="#f04747"
                                                    Foreground="White"
                                                    Padding="12,6"
                                                    CornerRadius="4"
                                                    FontSize="12"
                                                    IsVisible="{Binding !IsRevoked}"
                                                    IsEnabled="{Binding !IsRevoking}"/>
                                        </StackPanel>
                                    </Grid>
                                </Border>
                            </DataTemplate>
                        </ItemsControl.ItemTemplate>
                    </ItemsControl>

                    <TextBlock Text="No invites yet"
                               Foreground="#72767d"
                               FontStyle="Italic"
                               IsVisible="{Binding !Invites.Count}"/>
                </StackPanel>
            </StackPanel>

            <!-- Users Tab -->
            <StackPanel IsVisible="{Binding IsUsersTabSelected}"
                        Spacing="16">
                <StackPanel Orientation="Horizontal" Spacing="8">
                    <TextBlock Text="USERS"
                               FontSize="12"
                               FontWeight="SemiBold"
                               Foreground="#72767d"
                               VerticalAlignment="Center"/>
                    <Button Command="{Binding RefreshUsersCommand}"
                            Content="Refresh"
                            Background="Transparent"
                            Foreground="#72767d"
                            Padding="8,4"
                            FontSize="11"
                            BorderThickness="0"/>
                </StackPanel>

                <TextBlock Text="{Binding UsersError}"
                           Foreground="#f04747"
                           FontSize="13"
                           IsVisible="{Binding UsersError, Converter={x:Static StringConverters.IsNotNullOrEmpty}}"/>

                <TextBlock Text="Loading..."
                           Foreground="#72767d"
                           IsVisible="{Binding IsLoadingUsers}"/>

                <ItemsControl ItemsSource="{Binding Users}">
                    <ItemsControl.ItemTemplate>
                        <DataTemplate DataType="{x:Type vm:UserViewModel}">
                            <Border Background="#2f3136" CornerRadius="8" Padding="16" Margin="0,0,0,8">
                                <Grid ColumnDefinitions="*,Auto">
                                    <StackPanel Spacing="8">
                                        <StackPanel Orientation="Horizontal" Spacing="12">
                                            <TextBlock Text="{Binding Username}"
                                                       FontSize="16"
                                                       FontWeight="SemiBold"
                                                       Foreground="White"/>
                                            <Border Background="#5865f2"
                                                    CornerRadius="4"
                                                    Padding="8,2"
                                                    IsVisible="{Binding IsServerAdmin}">
                                                <TextBlock Text="Admin"
                                                           FontSize="11"
                                                           Foreground="White"
                                                           FontWeight="SemiBold"/>
                                            </Border>
                                            <Ellipse Width="8" Height="8"
                                                     VerticalAlignment="Center"
                                                     Classes.online="{Binding IsOnline}">
                                                <Ellipse.Styles>
                                                    <Style Selector="Ellipse">
                                                        <Setter Property="Fill" Value="#747f8d"/>
                                                    </Style>
                                                    <Style Selector="Ellipse.online">
                                                        <Setter Property="Fill" Value="#43b581"/>
                                                    </Style>
                                                </Ellipse.Styles>
                                            </Ellipse>
                                        </StackPanel>

                                        <StackPanel Orientation="Horizontal" Spacing="16">
                                            <TextBlock FontSize="12" Foreground="#72767d">
                                                <Run Text="Email: "/>
                                                <Run Text="{Binding Email}" Foreground="#b9bbbe"/>
                                            </TextBlock>
                                            <TextBlock FontSize="12" Foreground="#72767d">
                                                <Run Text="Invited by: "/>
                                                <Run Text="{Binding InvitedByDisplay}" Foreground="#b9bbbe"/>
                                            </TextBlock>
                                            <TextBlock FontSize="12" Foreground="#72767d">
                                                <Run Text="Joined: "/>
                                                <Run Text="{Binding CreatedAt, StringFormat='{}{0:d}'}" Foreground="#b9bbbe"/>
                                            </TextBlock>
                                        </StackPanel>

                                        <TextBlock Text="{Binding Error}"
                                                   Foreground="#f04747"
                                                   FontSize="12"
                                                   IsVisible="{Binding Error, Converter={x:Static StringConverters.IsNotNullOrEmpty}}"/>
                                    </StackPanel>

                                    <Panel Grid.Column="1">
                                        <StackPanel Orientation="Horizontal"
                                                    Spacing="8"
                                                    IsVisible="{Binding !ShowDeleteConfirmation}">
                                            <Button Command="{Binding ToggleAdminCommand}"
                                                    Content="{Binding ToggleAdminButtonText}"
                                                    Background="#4f545c"
                                                    Foreground="White"
                                                    Padding="12,6"
                                                    CornerRadius="4"
                                                    FontSize="12"
                                                    IsEnabled="{Binding !IsUpdating}"/>
                                            <Button Command="{Binding ShowDeleteConfirmationCommand}"
                                                    Content="Delete"
                                                    Background="#f04747"
                                                    Foreground="White"
                                                    Padding="12,6"
                                                    CornerRadius="4"
                                                    FontSize="12"/>
                                        </StackPanel>

                                        <StackPanel Orientation="Horizontal"
                                                    Spacing="8"
                                                    IsVisible="{Binding ShowDeleteConfirmation}">
                                            <TextBlock Text="Confirm?"
                                                       Foreground="#f04747"
                                                       VerticalAlignment="Center"
                                                       FontWeight="SemiBold"/>
                                            <Button Command="{Binding DeleteCommand}"
                                                    Content="Yes, Delete"
                                                    Background="#f04747"
                                                    Foreground="White"
                                                    Padding="12,6"
                                                    CornerRadius="4"
                                                    FontSize="12"
                                                    IsEnabled="{Binding !IsDeleting}"/>
                                            <Button Command="{Binding CancelDeleteCommand}"
                                                    Content="Cancel"
                                                    Background="#4f545c"
                                                    Foreground="White"
                                                    Padding="12,6"
                                                    CornerRadius="4"
                                                    FontSize="12"/>
                                        </StackPanel>
                                    </Panel>
                                </Grid>
                            </Border>
                        </DataTemplate>
                    </ItemsControl.ItemTemplate>
                </ItemsControl>

                <TextBlock Text="No users yet"
                           Foreground="#72767d"
                           FontStyle="Italic"
                           IsVisible="{Binding !Users.Count}"/>
            </StackPanel>

            <!-- Config Tab -->
            <StackPanel IsVisible="{Binding IsConfigTabSelected}"
                        Spacing="16">
                <TextBlock Text="OPTIONAL FEATURES"
                           FontSize="12"
                           FontWeight="SemiBold"
                           Foreground="#72767d"/>

                <TextBlock Text="Some features require additional configuration on the server. Missing configuration is indicated below."
                           Foreground="#b9bbbe"
                           FontSize="13"
                           TextWrapping="Wrap"/>

                <!-- GIF Support -->
                <Border Background="#2f3136" CornerRadius="8" Padding="16">
                    <Grid ColumnDefinitions="*,Auto">
                        <StackPanel Spacing="4">
                            <StackPanel Orientation="Horizontal" Spacing="8">
                                <TextBlock Text="GIF Search"
                                           FontSize="15"
                                           FontWeight="SemiBold"
                                           Foreground="White"/>
                                <Border CornerRadius="4"
                                        Padding="6,2"
                                        Background="#43b581"
                                        IsVisible="{Binding IsGifsEnabled}">
                                    <TextBlock Text="Enabled"
                                               FontSize="11"
                                               FontWeight="SemiBold"
                                               Foreground="White"/>
                                </Border>
                                <Border CornerRadius="4"
                                        Padding="6,2"
                                        Background="#f04747"
                                        IsVisible="{Binding !IsGifsEnabled}">
                                    <TextBlock Text="Disabled"
                                               FontSize="11"
                                               FontWeight="SemiBold"
                                               Foreground="White"/>
                                </Border>
                            </StackPanel>
                            <TextBlock Text="Allows users to search and send GIFs via Tenor"
                                       FontSize="13"
                                       Foreground="#72767d"/>
                        </StackPanel>

                        <StackPanel Grid.Column="1" VerticalAlignment="Center" IsVisible="{Binding !IsGifsEnabled}">
                            <TextBlock Text="Missing: Tenor API Key"
                                       Foreground="#faa61a"
                                       FontSize="12"
                                       FontWeight="SemiBold"/>
                        </StackPanel>
                    </Grid>
                </Border>

                <!-- Configuration Instructions -->
                <Border Background="#2f3136" CornerRadius="8" Padding="16" IsVisible="{Binding HasMissingConfiguration}">
                    <StackPanel Spacing="8">
                        <TextBlock Text="HOW TO CONFIGURE"
                                   FontSize="12"
                                   FontWeight="SemiBold"
                                   Foreground="#72767d"/>

                        <TextBlock TextWrapping="Wrap"
                                   Foreground="#b9bbbe"
                                   FontSize="13">
                            <Run Text="To enable missing features, update your server's "/><Run Text="appsettings.json" FontFamily="Consolas, Monaco, monospace" Foreground="#7289da"/><Run Text=" or set environment variables:"/>
                        </TextBlock>

                        <Border Background="#202225" CornerRadius="4" Padding="12" IsVisible="{Binding !IsGifsEnabled}">
                            <StackPanel Spacing="4">
                                <TextBlock Text="GIF Search (Tenor API):"
                                           FontSize="12"
                                           FontWeight="SemiBold"
                                           Foreground="#dcddde"/>
                                <TextBlock Text="1. Get a free API key at: https://developers.google.com/tenor"
                                           FontSize="12"
                                           Foreground="#b9bbbe"/>
                                <TextBlock FontSize="12"
                                           Foreground="#b9bbbe">
                                    <Run Text="2. Set "/><Run Text="Tenor__ApiKey" FontFamily="Consolas, Monaco, monospace" Foreground="#7289da"/><Run Text=" environment variable"/>
                                </TextBlock>
                                <TextBlock FontSize="12"
                                           Foreground="#b9bbbe">
                                    <Run Text="   Or add to appsettings.json: "/><Run Text="&quot;Tenor&quot;: { &quot;ApiKey&quot;: &quot;YOUR_KEY&quot; }" FontFamily="Consolas, Monaco, monospace" Foreground="#7289da"/>
                                </TextBlock>
                                <TextBlock Text="3. Restart the server"
                                           FontSize="12"
                                           Foreground="#b9bbbe"/>
                            </StackPanel>
                        </Border>
                    </StackPanel>
                </Border>

                <!-- All configured message -->
                <Border Background="#2f3136" CornerRadius="8" Padding="16" IsVisible="{Binding !HasMissingConfiguration}">
                    <StackPanel Orientation="Horizontal" Spacing="8">
                        <TextBlock Text="&#x2713;"
                                   FontSize="16"
                                   Foreground="#43b581"/>
                        <TextBlock Text="All optional features are configured!"
                                   FontSize="14"
                                   Foreground="#43b581"/>
                    </StackPanel>
                </Border>
            </StackPanel>
        </StackPanel>
    </ScrollViewer>
</UserControl>
