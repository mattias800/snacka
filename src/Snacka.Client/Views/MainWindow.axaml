<Window xmlns="https://github.com/avaloniaui"
        xmlns:x="http://schemas.microsoft.com/winfx/2006/xaml"
        xmlns:vm="using:Snacka.Client.ViewModels"
        xmlns:views="using:Snacka.Client.Views"
        x:Class="Snacka.Client.Views.MainWindow"
        x:DataType="vm:MainWindowViewModel"
        Title="Snacka"
        Icon="/Assets/snacka-icon.png"
        Width="1200"
        Height="800"
        MinWidth="800"
        MinHeight="600"
        Background="#202225">

    <Window.DataTemplates>
        <DataTemplate DataType="{x:Type vm:LoadingViewModel}">
            <views:LoadingView/>
        </DataTemplate>
        <DataTemplate DataType="{x:Type vm:ServerConnectionViewModel}">
            <views:ServerConnectionView/>
        </DataTemplate>
        <DataTemplate DataType="{x:Type vm:LoginViewModel}">
            <views:LoginView/>
        </DataTemplate>
        <DataTemplate DataType="{x:Type vm:RegisterViewModel}">
            <views:RegisterView/>
        </DataTemplate>
        <DataTemplate DataType="{x:Type vm:MainAppViewModel}">
            <views:MainAppView/>
        </DataTemplate>
        <DataTemplate DataType="{x:Type vm:SettingsViewModel}">
            <views:SettingsView/>
        </DataTemplate>
    </Window.DataTemplates>

    <Grid RowDefinitions="Auto,Auto,*">
        <!-- Hardware Acceleration Warning Banner -->
        <Border Grid.Row="0"
                Background="#FAA61A"
                Padding="12,8"
                IsVisible="{Binding ShowHardwareWarningBanner}">
            <Grid ColumnDefinitions="Auto,*,Auto">
                <TextBlock Grid.Column="0" Text="&#x26A0;" FontSize="16" VerticalAlignment="Center" Margin="0,0,8,0"/>
                <TextBlock Grid.Column="1"
                           Text="{Binding HardwareWarningMessage}"
                           Foreground="#202225"
                           VerticalAlignment="Center"
                           TextWrapping="Wrap"/>
                <Button Grid.Column="2"
                        Content="&#x2715;"
                        Command="{Binding DismissHardwareWarningBanner}"
                        Background="Transparent"
                        Foreground="#202225"
                        Padding="8,4"
                        FontSize="14"/>
            </Grid>
        </Border>

        <!-- Update Banner -->
        <Border Grid.Row="1"
                Background="#5865F2"
                Padding="12,8"
                IsVisible="{Binding ShowUpdateBanner}">
            <Grid ColumnDefinitions="*,Auto,Auto,Auto">
                <!-- Update Available State -->
                <StackPanel Grid.Column="0" Orientation="Horizontal" Spacing="8" VerticalAlignment="Center"
                            IsVisible="{Binding IsUpdateAvailable}">
                    <TextBlock Text="&#x2728;" FontSize="16"/>
                    <TextBlock VerticalAlignment="Center" Foreground="White">
                        <Run Text="A new version is available:"/>
                        <Run Text="{Binding UpdateInfo.Version}" FontWeight="Bold"/>
                    </TextBlock>
                </StackPanel>

                <!-- Downloading State -->
                <StackPanel Grid.Column="0" Orientation="Horizontal" Spacing="12" VerticalAlignment="Center"
                            IsVisible="{Binding IsUpdateDownloading}">
                    <TextBlock Text="&#x2B07;" FontSize="16"/>
                    <TextBlock Text="Downloading update..." Foreground="White" VerticalAlignment="Center"/>
                    <ProgressBar Value="{Binding UpdateDownloadProgress}"
                                 Minimum="0" Maximum="100"
                                 Width="200" Height="8"
                                 Foreground="White"
                                 Background="#4752C4"/>
                    <TextBlock Text="{Binding UpdateDownloadProgress, StringFormat='{}{0}%'}"
                               Foreground="White" VerticalAlignment="Center" Width="40"/>
                </StackPanel>

                <!-- Ready to Install State -->
                <StackPanel Grid.Column="0" Orientation="Horizontal" Spacing="8" VerticalAlignment="Center"
                            IsVisible="{Binding IsUpdateReadyToInstall}">
                    <TextBlock Text="&#x2705;" FontSize="16"/>
                    <TextBlock VerticalAlignment="Center" Foreground="White">
                        <Run Text="Update"/>
                        <Run Text="{Binding UpdateInfo.Version}" FontWeight="Bold"/>
                        <Run Text="downloaded. Restart to apply."/>
                    </TextBlock>
                </StackPanel>

                <!-- Download Button (when update available) -->
                <Button Grid.Column="1"
                        Content="Download"
                        Command="{Binding DownloadUpdate}"
                        Background="#4752C4"
                        Foreground="White"
                        Padding="16,6"
                        Margin="8,0"
                        CornerRadius="4"
                        IsVisible="{Binding IsUpdateAvailable}"/>

                <!-- Restart Button (when downloaded) -->
                <Button Grid.Column="1"
                        Content="Restart Now"
                        Command="{Binding RestartToUpdate}"
                        Background="#43b581"
                        Foreground="White"
                        Padding="16,6"
                        Margin="8,0"
                        CornerRadius="4"
                        IsVisible="{Binding IsUpdateReadyToInstall}"/>

                <!-- View Release Notes link -->
                <Button Grid.Column="2"
                        Content="Release Notes"
                        Command="{Binding OpenUpdatePage}"
                        Background="Transparent"
                        Foreground="White"
                        Padding="8,6"
                        Margin="0"
                        FontSize="12"
                        IsVisible="{Binding !IsUpdateDownloading}"/>

                <!-- Dismiss Button -->
                <Button Grid.Column="3"
                        Content="&#x2715;"
                        Command="{Binding DismissUpdateBanner}"
                        Background="Transparent"
                        Foreground="White"
                        Padding="8,4"
                        FontSize="14"/>
            </Grid>
        </Border>

        <!-- Main Content -->
        <ContentControl Grid.Row="2" Content="{Binding CurrentView}"/>
    </Grid>
</Window>
