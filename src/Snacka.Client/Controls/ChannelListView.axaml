<UserControl xmlns="https://github.com/avaloniaui"
             xmlns:x="http://schemas.microsoft.com/winfx/2006/xaml"
             xmlns:d="http://schemas.microsoft.com/expression/blend/2008"
             xmlns:mc="http://schemas.openxmlformats.org/markup-compatibility/2006"
             xmlns:conv="using:Snacka.Client.Converters"
             xmlns:controls="using:Snacka.Client.Controls"
             xmlns:services="using:Snacka.Client.Services"
             xmlns:vm="using:Snacka.Client.ViewModels"
             xmlns:ui="using:FluentAvalonia.UI.Controls"
             mc:Ignorable="d"
             x:Class="Snacka.Client.Controls.ChannelListView"
             x:DataType="controls:ChannelListView">

    <UserControl.Styles>
        <!-- Drop indicator style -->
        <Style Selector="Border.drop-indicator">
            <Setter Property="Height" Value="2"/>
            <Setter Property="Background" Value="#5865f2"/>
            <Setter Property="CornerRadius" Value="1"/>
            <Setter Property="Margin" Value="8,0"/>
            <Setter Property="IsVisible" Value="False"/>
            <Setter Property="Opacity" Value="0"/>
            <Setter Property="Transitions">
                <Transitions>
                    <DoubleTransition Property="Opacity" Duration="0:0:0.15"/>
                </Transitions>
            </Setter>
        </Style>
        <Style Selector="Border.drop-indicator.active">
            <Setter Property="IsVisible" Value="True"/>
            <Setter Property="Opacity" Value="1"/>
        </Style>

        <!-- Channel item hover effect during drag -->
        <Style Selector="Button.channel-btn.drag-over">
            <Setter Property="Background" Value="#4e5058"/>
        </Style>
        <Style Selector="Border.voice-channel-item.drag-over">
            <Setter Property="Background" Value="#4e5058"/>
        </Style>

        <!-- Channel item transition for smooth reordering -->
        <Style Selector="Button.channel-btn">
            <Setter Property="RenderTransform" Value="none"/>
            <Setter Property="Transitions">
                <Transitions>
                    <TransformOperationsTransition Property="RenderTransform" Duration="0:0:0.2" Easing="CubicEaseOut"/>
                    <DoubleTransition Property="Opacity" Duration="0:0:0.15"/>
                </Transitions>
            </Setter>
        </Style>

        <Style Selector="Border.voice-channel-item">
            <Setter Property="RenderTransform" Value="none"/>
            <Setter Property="Transitions">
                <Transitions>
                    <TransformOperationsTransition Property="RenderTransform" Duration="0:0:0.2" Easing="CubicEaseOut"/>
                    <DoubleTransition Property="Opacity" Duration="0:0:0.15"/>
                </Transitions>
            </Setter>
        </Style>

        <!-- Dragging state - hide the original item -->
        <Style Selector="Button.channel-btn.dragging">
            <Setter Property="Opacity" Value="0.3"/>
            <Setter Property="RenderTransform" Value="scale(0.98)"/>
        </Style>
        <Style Selector="Border.voice-channel-item.dragging">
            <Setter Property="Opacity" Value="0.3"/>
            <Setter Property="RenderTransform" Value="scale(0.98)"/>
        </Style>

        <!-- Placeholder gap style -->
        <Style Selector="Border.drop-placeholder">
            <Setter Property="Height" Value="0"/>
            <Setter Property="Background" Value="Transparent"/>
            <Setter Property="Transitions">
                <Transitions>
                    <DoubleTransition Property="Height" Duration="0:0:0.15" Easing="CubicEaseOut"/>
                </Transitions>
            </Setter>
        </Style>
        <Style Selector="Border.drop-placeholder.active">
            <Setter Property="Height" Value="32"/>
        </Style>

        <!-- Drag ghost style -->
        <Style Selector="Border.drag-ghost">
            <Setter Property="Background" Value="#2b2d31"/>
            <Setter Property="CornerRadius" Value="8"/>
            <Setter Property="Padding" Value="10,8"/>
            <Setter Property="Opacity" Value="0.95"/>
            <Setter Property="BoxShadow" Value="0 4 16 0 #66000000"/>
        </Style>
    </UserControl.Styles>

    <Panel>
        <!-- Drag ghost overlay - positioned absolutely -->
        <Border x:Name="DragGhost"
                Classes="drag-ghost"
                IsVisible="False"
                IsHitTestVisible="False"
                HorizontalAlignment="Left"
                VerticalAlignment="Top"
                ZIndex="1000">
            <StackPanel Orientation="Horizontal" Spacing="8">
                <TextBlock x:Name="DragGhostIcon"
                           Text="#"
                           Foreground="{StaticResource Foreground3Brush}"
                           FontSize="14"
                           VerticalAlignment="Center"/>
                <TextBlock x:Name="DragGhostName"
                           Text=""
                           Classes="text-body"
                           FontSize="14"
                           VerticalAlignment="Center"/>
            </StackPanel>
        </Border>

        <ScrollViewer>
        <StackPanel>
            <!-- Loading indicator -->
            <TextBlock Text="Loading channels..."
                       Classes="text-muted"
                       FontSize="12"
                       Margin="16,12"
                       IsVisible="{Binding IsLoading, RelativeSource={RelativeSource AncestorType=controls:ChannelListView}}"/>

            <!-- Text Channels Section -->
            <Grid Margin="12,12,12,6">
                <Grid.ColumnDefinitions>
                    <ColumnDefinition Width="*"/>
                    <ColumnDefinition Width="Auto"/>
                </Grid.ColumnDefinitions>
                <TextBlock Grid.Column="0"
                           Text="TEXT CHANNELS"
                           Classes="text-caption"
                           VerticalAlignment="Center"/>
                <Button Grid.Column="1"
                        Classes="btn-icon"
                        Command="{Binding CreateChannelCommand, RelativeSource={RelativeSource AncestorType=controls:ChannelListView}}"
                        Padding="4"
                        MinWidth="24"
                        MinHeight="24"
                        ToolTip.Tip="Create Text Channel"
                        IsEnabled="{Binding IsLoading, RelativeSource={RelativeSource AncestorType=controls:ChannelListView}, Converter={x:Static BoolConverters.Not}}"
                        IsVisible="{Binding CanManageChannels, RelativeSource={RelativeSource AncestorType=controls:ChannelListView}}">
                    <ui:SymbolIcon Symbol="Add"
                               Foreground="{StaticResource Foreground3Brush}"
                               FontSize="14"/>
                </Button>
            </Grid>

            <!-- Drop indicator for top of text channels list -->
            <Border x:Name="TextChannelsTopDropIndicator" Classes="drop-indicator"/>

            <ItemsControl x:Name="TextChannelsList"
                          ItemsSource="{Binding TextChannels, RelativeSource={RelativeSource AncestorType=controls:ChannelListView}}"
                          Margin="4,0">
                <ItemsControl.ItemTemplate>
                    <DataTemplate x:DataType="services:ChannelResponse">
                        <StackPanel>
                            <!-- Drop indicator above this channel -->
                            <Border Classes="drop-indicator" Tag="{Binding}"/>
                            <Button Classes="channel-btn"
                                    Command="{Binding SelectChannelCommand, RelativeSource={RelativeSource AncestorType=controls:ChannelListView}}"
                                    CommandParameter="{Binding}"
                                    HorizontalAlignment="Stretch"
                                    HorizontalContentAlignment="Stretch"
                                    Padding="10,8"
                                    Margin="0,1"
                                    Cursor="Hand"
                                    DoubleTapped="OnChannelDoubleTapped"
                                    Tag="{Binding}"
                                    PointerPressed="OnTextChannelPointerPressed"
                                    PointerMoved="OnTextChannelPointerMoved"
                                    PointerReleased="OnTextChannelPointerReleased"
                                    DragDrop.AllowDrop="True"
                                    DragDrop.DragOver="OnTextChannelDragOver"
                                    DragDrop.Drop="OnTextChannelDrop">
                                <!-- Context menu for text channels -->
                                <Button.ContextMenu>
                                    <ContextMenu Opened="OnTextChannelContextMenuOpened">
                                        <MenuItem Header="Rename Channel"
                                                  x:Name="RenameTextChannelItem"
                                                  Click="OnRenameChannelClick"
                                                  Tag="{Binding}">
                                            <MenuItem.Icon>
                                                <ui:SymbolIcon Symbol="Edit" FontSize="12"/>
                                            </MenuItem.Icon>
                                        </MenuItem>
                                        <Separator x:Name="TextChannelSeparator"/>
                                        <MenuItem Header="Delete Channel"
                                                  x:Name="DeleteTextChannelItem"
                                                  Click="OnDeleteChannelClick"
                                                  Tag="{Binding}"
                                                  Foreground="{StaticResource DangerBrush}">
                                            <MenuItem.Icon>
                                                <ui:SymbolIcon Symbol="Delete" FontSize="12"/>
                                            </MenuItem.Icon>
                                        </MenuItem>
                                    </ContextMenu>
                                </Button.ContextMenu>
                                <Grid>
                                    <Grid.ColumnDefinitions>
                                        <ColumnDefinition Width="*"/>
                                        <ColumnDefinition Width="Auto"/>
                                        <ColumnDefinition Width="Auto"/>
                                    </Grid.ColumnDefinitions>
                                    <StackPanel Grid.Column="0" Orientation="Horizontal" Spacing="8">
                                        <TextBlock Text="#"
                                                   Foreground="{StaticResource Foreground3Brush}"
                                                   FontSize="18"
                                                   VerticalAlignment="Center"/>
                                        <TextBlock Text="{Binding Name}"
                                                   Classes="text-secondary"
                                                   FontSize="14"
                                                   VerticalAlignment="Center"/>
                                    </StackPanel>
                                    <!-- Unread badge -->
                                    <Border Grid.Column="1"
                                            Background="{StaticResource DangerBrush}"
                                            CornerRadius="10"
                                            Padding="6,2"
                                            Margin="4,0"
                                            VerticalAlignment="Center"
                                            IsVisible="{Binding UnreadCount, Converter={x:Static conv:IntGreaterThanZeroConverter.Instance}}">
                                        <TextBlock Text="{Binding UnreadCount}"
                                                   Foreground="White"
                                                   FontSize="11"
                                                   FontWeight="SemiBold"/>
                                    </Border>
                                    <Button Grid.Column="2"
                                            Classes="btn-icon"
                                            Command="{Binding StartEditChannelCommand, RelativeSource={RelativeSource AncestorType=controls:ChannelListView}}"
                                            CommandParameter="{Binding}"
                                            Padding="4"
                                            MinWidth="24"
                                            MinHeight="24"
                                            ToolTip.Tip="Rename Channel"
                                            IsVisible="{Binding CanManageChannels, RelativeSource={RelativeSource AncestorType=controls:ChannelListView}}">
                                        <ui:SymbolIcon Symbol="Edit"
                                                   Foreground="{StaticResource Foreground3Brush}"
                                                   FontSize="11"/>
                                    </Button>
                                </Grid>
                            </Button>
                        </StackPanel>
                    </DataTemplate>
                </ItemsControl.ItemTemplate>
            </ItemsControl>

            <!-- Drop indicator at bottom of text channels -->
            <Border x:Name="TextChannelsBottomDropIndicator" Classes="drop-indicator"/>

            <!-- Voice Channels Section -->
            <Grid Margin="12,20,12,6">
                <Grid.ColumnDefinitions>
                    <ColumnDefinition Width="*"/>
                    <ColumnDefinition Width="Auto"/>
                </Grid.ColumnDefinitions>
                <TextBlock Grid.Column="0"
                           Text="VOICE CHANNELS"
                           Classes="text-caption"
                           VerticalAlignment="Center"/>
                <Button Grid.Column="1"
                        Classes="btn-icon"
                        Command="{Binding CreateVoiceChannelCommand, RelativeSource={RelativeSource AncestorType=controls:ChannelListView}}"
                        Padding="4"
                        MinWidth="24"
                        MinHeight="24"
                        ToolTip.Tip="Create Voice Channel"
                        IsEnabled="{Binding IsLoading, RelativeSource={RelativeSource AncestorType=controls:ChannelListView}, Converter={x:Static BoolConverters.Not}}"
                        IsVisible="{Binding CanManageChannels, RelativeSource={RelativeSource AncestorType=controls:ChannelListView}}">
                    <ui:SymbolIcon Symbol="Add"
                               Foreground="{StaticResource Foreground3Brush}"
                               FontSize="14"/>
                </Button>
            </Grid>

            <!-- Drop indicator for top of voice channels list -->
            <Border x:Name="VoiceChannelsTopDropIndicator" Classes="drop-indicator"/>

            <!-- Voice Channels with participant tracking -->
            <ItemsControl x:Name="VoiceChannelsList"
                          ItemsSource="{Binding VoiceChannels, RelativeSource={RelativeSource AncestorType=controls:ChannelListView}}"
                          Margin="4,0">
                <ItemsControl.ItemTemplate>
                    <DataTemplate x:DataType="vm:VoiceChannelViewModel">
                        <StackPanel>
                            <!-- Gap above this voice channel (shown during drag) -->
                            <Border Classes="drop-placeholder"
                                    Classes.active="{Binding ShowGapAbove}"/>
                            <Border Classes="voice-channel-item"
                                    Padding="10,8"
                                    Margin="0,1"
                                    Cursor="Hand"
                                    Opacity="{Binding IsDragSource, Converter={x:Static conv:BoolToOpacityConverter.Instance}}"
                                    PointerPressed="VoiceChannel_PointerPressed"
                                    PointerMoved="VoiceChannel_PointerMoved"
                                    PointerReleased="VoiceChannel_PointerReleased"
                                    Tag="{Binding Channel}">
                                <!-- Context menu for voice channels -->
                                <Border.ContextMenu>
                                    <ContextMenu Opened="OnVoiceChannelContextMenuOpened">
                                        <MenuItem Header="Rename Channel"
                                                  x:Name="RenameVoiceChannelItem"
                                                  Click="OnRenameChannelClick"
                                                  Tag="{Binding Channel}">
                                            <MenuItem.Icon>
                                                <ui:SymbolIcon Symbol="Edit" FontSize="12"/>
                                            </MenuItem.Icon>
                                        </MenuItem>
                                        <Separator x:Name="VoiceChannelSeparator"/>
                                        <MenuItem Header="Delete Channel"
                                                  x:Name="DeleteVoiceChannelItem"
                                                  Click="OnDeleteChannelClick"
                                                  Tag="{Binding Channel}"
                                                  Foreground="{StaticResource DangerBrush}">
                                            <MenuItem.Icon>
                                                <ui:SymbolIcon Symbol="Delete" FontSize="12"/>
                                            </MenuItem.Icon>
                                        </MenuItem>
                                    </ContextMenu>
                                </Border.ContextMenu>
                                <StackPanel Orientation="Horizontal" Spacing="8">
                                    <ui:SymbolIcon Symbol="Speaker2"
                                               Foreground="{StaticResource Foreground3Brush}"
                                               FontSize="14"
                                               VerticalAlignment="Center"/>
                                    <TextBlock Text="{Binding Name}"
                                               Classes="text-secondary"
                                               FontSize="14"
                                               VerticalAlignment="Center"/>
                                </StackPanel>
                            </Border>
                            <!-- Voice Participants - directly bound to ObservableCollection -->
                            <ItemsControl ItemsSource="{Binding Participants}" Margin="28,0,0,4">
                                <ItemsControl.ItemTemplate>
                                    <DataTemplate>
                                        <Border Classes="voice-participant" Margin="4,2">
                                            <!-- Context menu for user volume (only for other users) -->
                                            <Border.ContextMenu>
                                                <ContextMenu>
                                                    <MenuItem Header="User Volume" IsEnabled="False"
                                                              IsVisible="{Binding !IsCurrentUser}">
                                                        <MenuItem.Icon>
                                                            <ui:SymbolIcon Symbol="Speaker2" FontSize="12"/>
                                                        </MenuItem.Icon>
                                                    </MenuItem>
                                                    <MenuItem IsVisible="{Binding !IsCurrentUser}">
                                                        <MenuItem.Header>
                                                            <StackPanel Orientation="Horizontal" Spacing="8">
                                                                <Slider Width="120" Minimum="0" Maximum="200"
                                                                        Value="{Binding VolumePercent}"
                                                                        VerticalAlignment="Center"/>
                                                                <TextBlock Text="{Binding VolumePercent, StringFormat={}{0}%}"
                                                                           Classes="text-body"
                                                                           FontSize="12"
                                                                           Width="40"
                                                                           VerticalAlignment="Center"/>
                                                            </StackPanel>
                                                        </MenuItem.Header>
                                                    </MenuItem>
                                                    <!-- Admin options separator -->
                                                    <Separator IsVisible="{Binding CanManageVoice, RelativeSource={RelativeSource AncestorType=controls:ChannelListView}}"/>
                                                    <!-- Server Mute (admin only, not for current user) -->
                                                    <MenuItem Header="{Binding IsServerMuted, Converter={x:Static conv:ServerMuteTextConverter.Instance}}"
                                                              Command="{Binding ServerMuteUserCommand, RelativeSource={RelativeSource AncestorType=controls:ChannelListView}}"
                                                              CommandParameter="{Binding}">
                                                        <MenuItem.IsVisible>
                                                            <MultiBinding Converter="{x:Static BoolConverters.And}">
                                                                <Binding Path="!IsCurrentUser"/>
                                                                <Binding Path="CanManageVoice" RelativeSource="{RelativeSource AncestorType=controls:ChannelListView}"/>
                                                            </MultiBinding>
                                                        </MenuItem.IsVisible>
                                                        <MenuItem.Icon>
                                                            <ui:SymbolIcon Symbol="SpeakerMute" FontSize="12"/>
                                                        </MenuItem.Icon>
                                                    </MenuItem>
                                                    <!-- Server Deafen (admin only, not for current user) -->
                                                    <MenuItem Header="{Binding IsServerDeafened, Converter={x:Static conv:ServerDeafenTextConverter.Instance}}"
                                                              Command="{Binding ServerDeafenUserCommand, RelativeSource={RelativeSource AncestorType=controls:ChannelListView}}"
                                                              CommandParameter="{Binding}">
                                                        <MenuItem.IsVisible>
                                                            <MultiBinding Converter="{x:Static BoolConverters.And}">
                                                                <Binding Path="!IsCurrentUser"/>
                                                                <Binding Path="CanManageVoice" RelativeSource="{RelativeSource AncestorType=controls:ChannelListView}"/>
                                                            </MultiBinding>
                                                        </MenuItem.IsVisible>
                                                        <MenuItem.Icon>
                                                            <ui:SymbolIcon Symbol="SpeakerMute" FontSize="12"/>
                                                        </MenuItem.Icon>
                                                    </MenuItem>
                                                    <MenuItem Header="(You)" IsEnabled="False"
                                                              IsVisible="{Binding IsCurrentUser}"/>
                                                </ContextMenu>
                                            </Border.ContextMenu>
                                            <!-- Username and status icons -->
                                            <StackPanel Orientation="Horizontal" Spacing="8">
                                                <Ellipse Width="24" Height="24" Fill="{StaticResource Content3Brush}"/>
                                                <TextBlock Text="{Binding Username}"
                                                           Foreground="{Binding IsSpeaking, Converter={x:Static conv:SpeakingForegroundConverter.Instance}}"
                                                           FontSize="13"
                                                           VerticalAlignment="Center"/>
                                                <!-- Self muted (red) - only show if self-muted but not server-muted -->
                                                <ui:SymbolIcon Symbol="Mute"
                                                           FontSize="10"
                                                           Foreground="{StaticResource DangerBrush}"
                                                           VerticalAlignment="Center"
                                                           ToolTip.Tip="Muted">
                                                    <ui:SymbolIcon.IsVisible>
                                                        <MultiBinding Converter="{x:Static BoolConverters.And}">
                                                            <Binding Path="IsMuted"/>
                                                            <Binding Path="!IsServerMuted"/>
                                                        </MultiBinding>
                                                    </ui:SymbolIcon.IsVisible>
                                                </ui:SymbolIcon>
                                                <!-- Server muted (orange) -->
                                                <ui:SymbolIcon Symbol="Mute"
                                                           FontSize="10"
                                                           Foreground="{StaticResource WarningBrush}"
                                                           VerticalAlignment="Center"
                                                           ToolTip.Tip="Server Muted"
                                                           IsVisible="{Binding IsServerMuted}"/>
                                                <!-- Self deafened (red) - only show if self-deafened but not server-deafened -->
                                                <ui:SymbolIcon Symbol="SpeakerMute"
                                                           FontSize="10"
                                                           Foreground="{StaticResource DangerBrush}"
                                                           VerticalAlignment="Center"
                                                           ToolTip.Tip="Deafened">
                                                    <ui:SymbolIcon.IsVisible>
                                                        <MultiBinding Converter="{x:Static BoolConverters.And}">
                                                            <Binding Path="IsDeafened"/>
                                                            <Binding Path="!IsServerDeafened"/>
                                                        </MultiBinding>
                                                    </ui:SymbolIcon.IsVisible>
                                                </ui:SymbolIcon>
                                                <!-- Server deafened (orange) -->
                                                <ui:SymbolIcon Symbol="SpeakerMute"
                                                           FontSize="10"
                                                           Foreground="{StaticResource WarningBrush}"
                                                           VerticalAlignment="Center"
                                                           ToolTip.Tip="Server Deafened"
                                                           IsVisible="{Binding IsServerDeafened}"/>
                                                <ui:SymbolIcon Symbol="Video"
                                                           FontSize="10"
                                                           Foreground="{StaticResource SuccessBrush}"
                                                           VerticalAlignment="Center"
                                                           IsVisible="{Binding IsCameraOn}"/>
                                            </StackPanel>
                                        </Border>
                                    </DataTemplate>
                                </ItemsControl.ItemTemplate>
                            </ItemsControl>
                            <!-- Gap below this voice channel (shown during drag) -->
                            <Border Classes="drop-placeholder"
                                    Classes.active="{Binding ShowGapBelow}"/>
                        </StackPanel>
                    </DataTemplate>
                </ItemsControl.ItemTemplate>
            </ItemsControl>

            <!-- Drop zone at bottom of voice channels -->
            <Border x:Name="VoiceChannelsBottomDropIndicator"
                    Height="20"
                    Background="Transparent">
                <Border Classes="drop-indicator" HorizontalAlignment="Stretch"/>
            </Border>

            <!-- Channel Rename Editor -->
            <Border Background="{StaticResource BackgroundBrush}"
                    CornerRadius="12"
                    Padding="12"
                    Margin="8,12,8,0"
                    IsVisible="{Binding EditingChannel, RelativeSource={RelativeSource AncestorType=controls:ChannelListView}, Converter={x:Static ObjectConverters.IsNotNull}}">
                <StackPanel Spacing="10">
                    <TextBlock Text="RENAME CHANNEL"
                               Classes="text-caption"/>
                    <TextBox x:Name="ChannelRenameInputBox"
                             Classes="input-default"
                             Text="{Binding EditingChannelName, RelativeSource={RelativeSource AncestorType=controls:ChannelListView}}"
                             IsEnabled="{Binding IsLoading, RelativeSource={RelativeSource AncestorType=controls:ChannelListView}, Converter={x:Static BoolConverters.Not}}"
                             KeyDown="OnChannelRenameKeyDown"/>
                    <StackPanel Orientation="Horizontal" Spacing="8" HorizontalAlignment="Right">
                        <Button Classes="btn-secondary"
                                Command="{Binding CancelEditChannelCommand, RelativeSource={RelativeSource AncestorType=controls:ChannelListView}}"
                                Content="Cancel"
                                Padding="12,6"
                                IsEnabled="{Binding IsLoading, RelativeSource={RelativeSource AncestorType=controls:ChannelListView}, Converter={x:Static BoolConverters.Not}}"/>
                        <Button Classes="btn-primary"
                                Command="{Binding SaveChannelNameCommand, RelativeSource={RelativeSource AncestorType=controls:ChannelListView}}"
                                Padding="12,6"
                                IsEnabled="{Binding IsLoading, RelativeSource={RelativeSource AncestorType=controls:ChannelListView}, Converter={x:Static BoolConverters.Not}}">
                            <Panel>
                                <TextBlock Text="Save" IsVisible="{Binding IsLoading, RelativeSource={RelativeSource AncestorType=controls:ChannelListView}, Converter={x:Static BoolConverters.Not}}"/>
                                <TextBlock Text="Saving..." IsVisible="{Binding IsLoading, RelativeSource={RelativeSource AncestorType=controls:ChannelListView}}"/>
                            </Panel>
                        </Button>
                    </StackPanel>
                </StackPanel>
            </Border>

            <!-- Channel Delete Confirmation -->
            <Border Background="{StaticResource BackgroundBrush}"
                    CornerRadius="12"
                    Padding="16"
                    Margin="8,12,8,0"
                    IsVisible="{Binding ChannelPendingDelete, RelativeSource={RelativeSource AncestorType=controls:ChannelListView}, Converter={x:Static ObjectConverters.IsNotNull}}">
                <StackPanel Spacing="12">
                    <TextBlock Text="DELETE CHANNEL"
                               Foreground="{StaticResource DangerBrush}"
                               FontSize="11"
                               FontWeight="SemiBold"/>
                    <TextBlock TextWrapping="Wrap"
                               Classes="text-body"
                               FontSize="13">
                        <Run Text="Are you sure you want to delete "/>
                        <Run Text="#" Foreground="{StaticResource Foreground3Brush}"/>
                        <Run Text="{Binding ChannelPendingDelete.Name, RelativeSource={RelativeSource AncestorType=controls:ChannelListView}}" FontWeight="SemiBold"/>
                        <Run Text="? This action cannot be undone."/>
                    </TextBlock>
                    <StackPanel Orientation="Horizontal" Spacing="8" HorizontalAlignment="Right">
                        <Button Classes="btn-secondary"
                                Command="{Binding CancelDeleteChannelCommand, RelativeSource={RelativeSource AncestorType=controls:ChannelListView}}"
                                Content="Cancel"
                                Padding="12,8"
                                IsEnabled="{Binding IsLoading, RelativeSource={RelativeSource AncestorType=controls:ChannelListView}, Converter={x:Static BoolConverters.Not}}"/>
                        <Button Classes="btn-danger"
                                Command="{Binding ConfirmDeleteChannelCommand, RelativeSource={RelativeSource AncestorType=controls:ChannelListView}}"
                                Padding="12,8"
                                IsEnabled="{Binding IsLoading, RelativeSource={RelativeSource AncestorType=controls:ChannelListView}, Converter={x:Static BoolConverters.Not}}">
                            <Panel>
                                <TextBlock Text="Delete" IsVisible="{Binding IsLoading, RelativeSource={RelativeSource AncestorType=controls:ChannelListView}, Converter={x:Static BoolConverters.Not}}"/>
                                <TextBlock Text="Deleting..." IsVisible="{Binding IsLoading, RelativeSource={RelativeSource AncestorType=controls:ChannelListView}}"/>
                            </Panel>
                        </Button>
                    </StackPanel>
                </StackPanel>
            </Border>
        </StackPanel>
    </ScrollViewer>
    </Panel>
</UserControl>
